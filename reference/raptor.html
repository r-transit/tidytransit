<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate travel times from one stop to all reachable stops — raptor • tidytransit</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate travel times from one stop to all reachable stops — raptor"><meta name="description" content="raptor finds the minimal travel time, earliest or latest arrival time for all
stops in stop_times with journeys departing from stop_ids within
time_range."><meta property="og:description" content="raptor finds the minimal travel time, earliest or latest arrival time for all
stops in stop_times with journeys departing from stop_ids within
time_range."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidytransit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.1.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Introduction to tidytransit</a></li>
    <li><a class="dropdown-item" href="../articles/servicepatterns.html">Service Patterns and Calendar Schedules</a></li>
    <li><a class="dropdown-item" href="../articles/timetable.html">Generate a Departure Timetable</a></li>
    <li><a class="dropdown-item" href="../articles/frequency.html">Transit (GTFS) Service &amp; Headway Mapping with R</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-transit/tidytransit/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate travel times from one stop to all reachable stops</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-transit/tidytransit/blob/master/R/raptor.R" class="external-link"><code>R/raptor.R</code></a></small>
      <div class="d-none name"><code>raptor.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>raptor</code> finds the minimal travel time, earliest or latest arrival time for all
stops in <code>stop_times</code> with journeys departing from <code>stop_ids</code> within
<code>time_range</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">raptor</span><span class="op">(</span></span>
<span>  <span class="va">stop_times</span>,</span>
<span>  <span class="va">transfers</span>,</span>
<span>  <span class="va">stop_ids</span>,</span>
<span>  arrival <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  time_range <span class="op">=</span> <span class="fl">3600</span>,</span>
<span>  max_transfers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  keep <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  separate_starts <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-stop-times">stop_times<a class="anchor" aria-label="anchor" href="#arg-stop-times"></a></dt>
<dd><p>A (prepared) stop_times table from a gtfs feed. Prepared means
that all stop time rows before the desired journey departure time
should be removed. The table should also only include departures
happening on one day. Use <code><a href="filter_stop_times.html">filter_stop_times()</a></code> for easier preparation.</p></dd>


<dt id="arg-transfers">transfers<a class="anchor" aria-label="anchor" href="#arg-transfers"></a></dt>
<dd><p>Transfers table from a gtfs feed. In general no preparation
is needed. Can be omitted if stop_times has been prepared with
<code><a href="filter_stop_times.html">filter_stop_times()</a></code>.</p></dd>


<dt id="arg-stop-ids">stop_ids<a class="anchor" aria-label="anchor" href="#arg-stop-ids"></a></dt>
<dd><p>Character vector with stop_ids from where journeys should start (or end).
It is recommended to only use stop_ids that are related to each other,
like different platforms in a train station or bus stops that are
reasonably close to each other.</p></dd>


<dt id="arg-arrival">arrival<a class="anchor" aria-label="anchor" href="#arg-arrival"></a></dt>
<dd><p>If FALSE (default), all journeys <em>start</em> from <code>stop_ids</code>. If
TRUE, all journeys <em>end</em> at <code>stop_ids</code>.</p></dd>


<dt id="arg-time-range">time_range<a class="anchor" aria-label="anchor" href="#arg-time-range"></a></dt>
<dd><p>Either a range in seconds or a vector containing the minimal and maximal
departure time (i.e. earliest and latest possible journey departure time)
as seconds or "HH:MM:SS" character. If <code>arrival</code> is TRUE, <code>time_range</code>
describes the time window when journeys should end at <code>stop_ids</code>.</p></dd>


<dt id="arg-max-transfers">max_transfers<a class="anchor" aria-label="anchor" href="#arg-max-transfers"></a></dt>
<dd><p>Maximum number of transfers allowed, no limit (NULL) as default.</p></dd>


<dt id="arg-keep">keep<a class="anchor" aria-label="anchor" href="#arg-keep"></a></dt>
<dd><p>One of c("all", "shortest", "earliest", "latest"). By default, <code>all</code> journeys
between stop_ids are returned. With <code>shortest</code> only the journey with the
shortest travel time is returned. With <code>earliest</code> the journey arriving at a
stop the earliest is returned, <code>latest</code> works accordingly.</p></dd>


<dt id="arg-separate-starts">separate_starts<a class="anchor" aria-label="anchor" href="#arg-separate-starts"></a></dt>
<dd><p>If <code>FALSE</code> (default), returns all initial transfers among the
specified <code>stop_ids</code>. If <code>TRUE</code> each stop_id is calculated independently. This
can lead to faster computation times and is useful when the resulting times between
<code>from</code> and <code>to_stop_ids</code> will be aggregated later (e.g. by <code>stop_name</code>
in <code><a href="travel_times.html">travel_times()</a></code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.table with journeys (departure, arrival and travel time) to/from all
stop_ids reachable by <code>stop_ids</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>With a modified <a href="https://www.microsoft.com/en-us/research/publication/round-based-public-transit-routing/" class="external-link">Round-Based Public Transit Routing Algorithm</a>
(RAPTOR) using data.table, earliest arrival times for all stops are calculated. If two
journeys arrive at the same time, the one with the later departure time and thus shorter
travel time is kept. By default, all journeys departing within <code>time_range</code> that arrive
at a stop are returned in a table. If you want all journeys <em>arriving</em> at stop_ids within
the specified time range, set <code>arrival</code> to TRUE.</p>
<p>Journeys are defined by a "from" and "to" stop_id, a departure, arrival and travel time.
Note that exact journeys (with each intermediate stop and route ids for example) are
<em>not</em> returned.</p>
<p>For most cases, <code>stop_times</code> needs to be filtered, as it should only contain trips
happening on a single day, see <code><a href="filter_stop_times.html">filter_stop_times()</a></code>. The algorithm scans all trips
until it exceeds <code>max_transfers</code> or all trips in <code>stop_times</code> have been visited.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="travel_times.html">travel_times()</a></code> for an easier access to travel time calculations via stop_names.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">nyc_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"nyc_subway.zip"</span>, package <span class="op">=</span> <span class="st">"tidytransit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nyc</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_gtfs.html">read_gtfs</a></span><span class="op">(</span><span class="va">nyc_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># you can use initial walk times to different stops in walking distance (arbitrary example values)</span></span></span>
<span class="r-in"><span><span class="va">stop_ids_harlem_st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"301"</span>, <span class="st">"301N"</span>, <span class="st">"301S"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">stop_ids_155_st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A11"</span>, <span class="st">"A11N"</span>, <span class="st">"A11S"</span>, <span class="st">"D12"</span>, <span class="st">"D12N"</span>, <span class="st">"D12S"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">walk_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>stop_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stop_ids_harlem_st</span>, <span class="va">stop_ids_155_st</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         walk_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">600</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">410</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use journeys departing after 7 AM with arrival time before 11 AM on 26th of June</span></span></span>
<span class="r-in"><span><span class="va">stop_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="filter_stop_times.html">filter_stop_times</a></span><span class="op">(</span><span class="va">nyc</span>, <span class="st">"2018-06-26"</span>, <span class="fl">7</span><span class="op">*</span><span class="fl">3600</span>, <span class="fl">9</span><span class="op">*</span><span class="fl">3600</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate all journeys departing from Harlem St or 155 St between 7:00 and 7:30</span></span></span>
<span class="r-in"><span><span class="va">rptr</span> <span class="op">&lt;-</span> <span class="fu">raptor</span><span class="op">(</span><span class="va">stop_times</span>, <span class="va">nyc</span><span class="op">$</span><span class="va">transfers</span>, <span class="va">walk_times</span><span class="op">$</span><span class="va">stop_id</span>, time_range <span class="op">=</span> <span class="fl">1800</span>,</span></span>
<span class="r-in"><span>               keep <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add walk times to travel times</span></span></span>
<span class="r-in"><span><span class="va">rptr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">rptr</span>, <span class="va">walk_times</span>, by.x <span class="op">=</span> <span class="st">"from_stop_id"</span>, by.y <span class="op">=</span> <span class="st">"stop_id"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rptr</span><span class="op">$</span><span class="va">travel_time_incl_walk</span> <span class="op">&lt;-</span> <span class="va">rptr</span><span class="op">$</span><span class="va">travel_time</span> <span class="op">+</span> <span class="va">rptr</span><span class="op">$</span><span class="va">walk_time</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get minimal travel times (with walk times) for all stop_ids</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘data.table’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:dplyr’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     between, first, last</span>
<span class="r-in"><span><span class="va">shortest_travel_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">rptr</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">travel_time_incl_walk</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"to_stop_id"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">shortest_travel_times</span><span class="op">$</span><span class="va">travel_time</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="raptor-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Flavio Poletti, Daniel Herszenhut, Mark Padgham, Tom Buckley, Danton Noriega-Goodwin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

