<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate travel times from one stop to all reachable stops — raptor • tidytransit</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate travel times from one stop to all reachable stops — raptor"><meta property="og:description" content="raptor finds the minimal travel time, earliest or latest arrival time for all
stops in stop_times with journeys departing from stop_ids within
time_range."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidytransit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/frequency.html">Transit (GTFS) Service &amp; Headway Mapping with R</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction to tidytransit</a>
    </li>
    <li>
      <a href="../articles/servicepatterns.html">Service Patterns and Calendar Schedules</a>
    </li>
    <li>
      <a href="../articles/timetable.html">Generate a Departure Timetable</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/r-transit/tidytransit/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate travel times from one stop to all reachable stops</h1>
    <small class="dont-index">Source: <a href="https://github.com/r-transit/tidytransit/blob/HEAD/R/raptor.R" class="external-link"><code>R/raptor.R</code></a></small>
    <div class="hidden name"><code>raptor.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>raptor</code> finds the minimal travel time, earliest or latest arrival time for all
stops in <code>stop_times</code> with journeys departing from <code>stop_ids</code> within
<code>time_range</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">raptor</span><span class="op">(</span>
  <span class="va">stop_times</span>,
  <span class="va">transfers</span>,
  <span class="va">stop_ids</span>,
  arrival <span class="op">=</span> <span class="cn">FALSE</span>,
  time_range <span class="op">=</span> <span class="fl">3600</span>,
  max_transfers <span class="op">=</span> <span class="cn">NULL</span>,
  keep <span class="op">=</span> <span class="st">"all"</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>stop_times</dt>
<dd><p>A (prepared) stop_times table from a gtfs feed. Prepared means
that all stop time rows before the desired journey departure time
should be removed. The table should also only include departures
happening on one day. Use <code><a href="filter_stop_times.html">filter_stop_times()</a></code> for easier preparation.</p></dd>
<dt>transfers</dt>
<dd><p>Transfers table from a gtfs feed. In general no preparation is needed.</p></dd>
<dt>stop_ids</dt>
<dd><p>Character vector with stop_ids from where journeys should start (or end)</p></dd>
<dt>arrival</dt>
<dd><p>If FALSE (default), all journeys <em>start</em> from <code>stop_ids</code>. If
TRUE, all journeys <em>end</em> at <code>stop_ids</code>.</p></dd>
<dt>time_range</dt>
<dd><p>Departure or arrival time range in seconds. All departures from the
first departure of stop_times (not necessarily from stop_id in
<code>stop_ids</code>) within <code>time_range</code> are considered. If <code>arrival</code> is TRUE,
all arrivals within <code>time_range</code> before the latest arrival time of
stop_times are considered.</p></dd>
<dt>max_transfers</dt>
<dd><p>Maximum number of transfers allowed, no limit (NULL) as default.</p></dd>
<dt>keep</dt>
<dd><p>One of c("all", "shortest", "earliest", "latest"). By default, <code>all</code> journeys
arriving at a stop are returned. With <code>shortest</code> the journey with shortest
travel time is returned. With <code>earliest</code> the journey arriving at a stop the
earliest is returned, <code>latest</code> works accordingly.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A data.table with journeys (departure, arrival and travel time) to/from all
stop_ids reachable by <code>stop_ids</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>With a modified <a href="https://www.microsoft.com/en-us/research/publication/round-based-public-transit-routing/" class="external-link">Round-Based Public Transit Routing Algorithm</a>
(RAPTOR) using data.table, earliest arrival times for all stops are calculated. If two
journeys arrive at the same time, the one with the later departure time and thus shorter
travel time is kept. By default, all journeys departing within <code>time_range</code> that arrive
at a stop are returned in a table. If you want all journeys <em>arriving</em> at stop_ids within
the specified time range, set <code>arrival</code> to TRUE.</p>
<p>Journeys are defined by a "from" and "to" stop_id, a departure, arrival and travel time.
Note that the exact journeys (with each intermediate stop and route ids for example) is
<em>not</em> returned.</p>
<p>For most cases, <code>stop_times</code> needs to be filtered, as it should only contain trips
happening on a single day and departures later than a given journey start time, see
<code><a href="filter_stop_times.html">filter_stop_times()</a></code>. The algorithm scans all trips until it exceeds <code>max_transfers</code>
or all trips in <code>stop_times</code> have been visited.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="travel_times.html">travel_times()</a></code> for an easier access to travel time calculations via stop_names.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="va">nyc_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"google_transit_nyc_subway.zip"</span>, package <span class="op">=</span> <span class="st">"tidytransit"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">nyc</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_gtfs.html">read_gtfs</a></span><span class="op">(</span><span class="va">nyc_path</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># you can use initial walk times to different stops in walking distance (arbitrary example values)</span></span>
<span class="r-in"><span class="va">stop_ids_harlem_st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"301"</span>, <span class="st">"301N"</span>, <span class="st">"301S"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">stop_ids_155_st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A11"</span>, <span class="st">"A11N"</span>, <span class="st">"A11S"</span>, <span class="st">"D12"</span>, <span class="st">"D12N"</span>, <span class="st">"D12S"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">walk_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>stop_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stop_ids_harlem_st</span>, <span class="va">stop_ids_155_st</span><span class="op">)</span>, </span>
<span class="r-in">                         walk_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">600</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">410</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Use journeys departing after 7 AM with arrival time before 11 AM on 26th of June</span></span>
<span class="r-in"><span class="va">stop_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="filter_stop_times.html">filter_stop_times</a></span><span class="op">(</span><span class="va">nyc</span>, <span class="st">"2018-06-26"</span>, <span class="fl">7</span><span class="op">*</span><span class="fl">3600</span>, <span class="fl">9</span><span class="op">*</span><span class="fl">3600</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># calculate all journeys departing from Harlem St or 155 St between 7:00 and 7:30</span></span>
<span class="r-in"><span class="va">rptr</span> <span class="op">&lt;-</span> <span class="fu">raptor</span><span class="op">(</span><span class="va">stop_times</span>, <span class="va">nyc</span><span class="op">$</span><span class="va">transfers</span>, <span class="va">walk_times</span><span class="op">$</span><span class="va">stop_id</span>, time_range <span class="op">=</span> <span class="fl">1800</span>,</span>
<span class="r-in">               keep <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># add walk times to travel times</span></span>
<span class="r-in"><span class="va">rptr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">rptr</span>, <span class="va">walk_times</span>, by.x <span class="op">=</span> <span class="st">"from_stop_id"</span>, by.y <span class="op">=</span> <span class="st">"stop_id"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">rptr</span><span class="op">$</span><span class="va">travel_time_incl_walk</span> <span class="op">&lt;-</span> <span class="va">rptr</span><span class="op">$</span><span class="va">travel_time</span> <span class="op">+</span> <span class="va">rptr</span><span class="op">$</span><span class="va">walk_time</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># get minimal travel times (with walk times) for all stop_ids</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘data.table’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:dplyr’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     between, first, last</span>
<span class="r-in"><span class="va">shortest_travel_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">rptr</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">order</a></span><span class="op">(</span><span class="va">travel_time_incl_walk</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"to_stop_id"</span><span class="op">]</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">shortest_travel_times</span><span class="op">$</span><span class="va">travel_time</span>, breaks <span class="op">=</span> <span class="fl">360</span><span class="op">)</span></span>
<span class="r-plt img"><img src="raptor-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Flavio Poletti, Daniel Herszenhut, Mark Padgham, Tom Buckley, Danton Noriega-Goodwin.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

